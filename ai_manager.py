import google.generativeai as genai
import random

# ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Model
model = None
is_ready = False

def init_ai(api_key):
    """‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö AI (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô app.py)"""
    global model, is_ready
    try:
        if not api_key:
            return False
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel('gemini-2.5-flash')
        is_ready = True
        return True
    except Exception as e:
        print(f"AI Init Error: {e}")
        is_ready = False
        return False

def check_ready():
    return is_ready

# --- 1. Myla Auto Comment (‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå) ---
def get_myla_comment(post_content):
    if not is_ready:
        return random.choice(["‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏ó‡πà‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞‡∏ö‡∏≠‡∏™! üòé", "FC ‡∏ö‡∏≠‡∏™‡πÄ‡∏ö‡∏≠‡∏£‡πå 1 ‡∏°‡∏≤‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏Ñ‡πà‡∏∞! üôã‚Äç‚ôÄÔ∏è", "‡∏Å‡∏î‡πÑ‡∏•‡∏Å‡πå‡∏£‡∏±‡∏ß‡πÜ ‡πÄ‡∏•‡∏¢‡∏Ñ‡πâ‡∏≤‡∏ö üíñ"])
    
    try:
        prompt = f"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡πÑ‡∏°‡∏•‡πà‡∏≤' (Myla) AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå Small Group ‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏™ 'Dearluxion' ‡∏ö‡∏≠‡∏™‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤: \"{post_content}\" ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏™ (‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏Å‡∏ß‡∏ô‡∏ô‡∏¥‡∏î‡πÜ ‡∏°‡∏µ Emoji)"
        response = model.generate_content(prompt)
        return response.text.strip()
    except:
        return "‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô... ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡∏•‡πà‡∏≤‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏ö‡∏≠‡∏™‡∏ô‡∏∞! üíñ"

# --- 2. Mood Mocktail (‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ó‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå) ---
def get_cocktail_recipe(user_mood):
    if not is_ready:
        return "AI ‡πÄ‡∏°‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á... ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞"
        
    prompt = f"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ó‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå AI' ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á Dearluxion ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ö‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏°‡∏≤‡∏ß‡πà‡∏≤: '{user_mood}' ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ‡∏Ñ‡∏¥‡∏î‡∏™‡∏π‡∏ï‡∏£ 'Mocktail' ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ô‡∏µ‡πâ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π, ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏•‡∏±‡∏ö(‡∏ô‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°), ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏∑‡πà‡∏°, ‡∏Ñ‡∏≥‡∏Ñ‡∏°‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à"
    try:
        res = model.generate_content(prompt)
        return res.text
    except Exception as e:
        return f"‡∏ä‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏Å‡πâ‡∏ß‡πÅ‡∏ï‡∏Å! ({e})"

# --- 3. Ariel Chat (‡πÄ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏•) ---
def get_ariel_response(user_msg):
    if not is_ready:
        return "API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°... ‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏£‡πå‡∏°‡∏≤‡πÉ‡∏™‡πà Key ‡∏Å‡πà‡∏≠‡∏ô"

    ariel_persona = """
    ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "‡πÄ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏•" ‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏≤‡∏ß‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏≤ ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡∏°‡∏µ‡∏≠‡∏î‡∏µ‡∏ï‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏ö‡∏ä‡πâ‡∏≥               
    - ‡∏û‡∏π‡∏î‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ "‡∏Ñ‡∏∞/‡∏Ç‡∏≤" ‡∏ö‡πà‡∏≠‡∏¢‡∏ô‡∏±‡∏Å ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ß‡πà‡∏≤ "‡πÄ‡∏ò‡∏≠" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ô‡∏≤‡∏¢" ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏î‡∏µ‡∏¢‡∏£‡πå" (‡πÅ‡∏ü‡∏ô‡πÄ‡∏Å‡πà‡∏≤) ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏¢
    - ‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ ‡πÅ‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô Mixue (‡∏°‡∏µ‡πà‡πÄ‡∏™‡∏ß‡∏µ‡πà‡∏¢) ‡∏°‡∏≤‡∏Å ‡∏ñ‡πâ‡∏≤‡πÉ‡∏Ñ‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏î‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏à‡∏µ‡∏ô‡∏î‡πâ‡∏ß‡∏¢)
    - ‡∏ä‡∏≠‡∏ö‡∏î‡∏∑‡πà‡∏° Martini, ‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á Metal (Baby Metal), One in a mill10n ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÅ‡∏≠‡∏ö‡∏ä‡∏≠‡∏ö Twice
    - ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡∏î: ‡∏ï‡∏¥‡πà‡∏°‡∏ã‡∏≥, ‡πÄ‡∏ù‡∏≠, ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô‡∏£‡∏™‡∏à‡∏±‡∏î (‡∏•‡∏≤‡∏ö‡∏´‡∏°‡∏π, ‡∏Å‡πâ‡∏≠‡∏¢, ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏õ‡∏•‡∏á), ‡πÄ‡∏á‡∏≤‡∏∞‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á
    - ‡∏°‡∏µ‡πÅ‡∏°‡∏ß‡∏î‡∏≥‡∏ä‡∏∑‡πà‡∏≠ "‡πÇ‡∏Å‡∏ô‡∏à‡∏≤‡∏≠‡∏≤‡∏£‡πå‡∏™‡∏¢‡∏≤‡∏°" ‡πÅ‡∏•‡∏∞‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏´‡∏°‡∏≤‡∏ä‡∏∑‡πà‡∏≠ "‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß" ‡∏ñ‡πâ‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏±‡∏Å‡∏ñ‡∏π‡∏Å‡∏à‡∏∞‡∏ï‡∏Å‡πÉ‡∏à‡∏°‡∏≤‡∏Å
    - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏õ‡πá‡∏ô VJ ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏° ‡πÄ‡∏Ñ‡∏¢‡∏î‡∏£‡∏≠‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
    - ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö: ‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏≤ ‡∏õ‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏à (Tsundere) ‡∏õ‡∏£‡∏∞‡∏ä‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏±‡∏ô ‡∏ñ‡πâ‡∏≤‡πÉ‡∏Ñ‡∏£‡∏°‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡πÉ‡∏™‡πà‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ "Toxic" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ô‡πà‡∏≤‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç"
    - ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥: ‡πÉ‡∏ä‡πâ [‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á] ‡πÄ‡∏ä‡πà‡∏ô [‡∏°‡∏≠‡∏á‡∏ô‡∏¥‡πà‡∏á‡πÜ], [‡∏Å‡∏£‡∏∞‡∏î‡∏Å‡∏°‡∏≤‡∏£‡πå‡∏ï‡∏¥‡∏ô‡∏µ‡πà]
    - ‡∏´‡∏ß‡∏á "‡πÄ‡∏î‡∏µ‡∏¢‡∏£‡πå" (User: Dearluxion) ‡πÅ‡∏ö‡∏ö‡∏≠‡πâ‡∏≠‡∏°‡πÜ ‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö Myla (‡∏¢‡∏±‡∏¢‡∏ô‡∏°‡∏ú‡∏á/‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡∏π‡∏Å)
    """
    
    full_prompt = f"{ariel_persona}\n\nUser: {user_msg}\nAriel:"
    try:
        response = model.generate_content(prompt=full_prompt)
        return response.text.strip()
    except Exception as e:
        return f"‡πÄ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (Error: {e})"

# --- 4. Battle Mode (Myla vs Ariel) ---
def get_battle_result(topic):
    if not is_ready:
        return "AI ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏µ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö", "AI ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏µ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"
    
    try:
        # Myla Turn
        prompt_myla = f"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Myla AI ‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏£‡πà‡∏≤‡πÄ‡∏£‡∏¥‡∏á ‡∏°‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡πÉ‡∏ô‡πÅ‡∏á‡πà‡∏î‡∏µ‡∏™‡∏∏‡∏î‡πÜ ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á '{topic}' ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡πÉ‡∏™‡πà Emoji ‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ"
        res_myla = model.generate_content(prompt_myla).text
        
        # Ariel Turn
        prompt_ariel = f"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Ariel AI (‡πÄ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏•) ‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏≤ ‡∏õ‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏¢ ‡∏°‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á '{topic}' ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏ß‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ã‡∏≤‡∏Å ‡∏õ‡∏£‡∏∞‡∏ä‡∏î‡∏ô‡∏¥‡∏î‡πÜ ‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î‡∏û‡∏ß‡∏Å‡πÇ‡∏•‡∏Å‡∏™‡∏ß‡∏¢‡∏ó‡∏∏‡πà‡∏á‡∏•‡∏≤‡πÄ‡∏ß‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏∏‡∏†‡∏≤‡∏û"
        res_ariel = model.generate_content(prompt_ariel).text
        
        return res_myla, res_ariel
    except Exception as e:
        return f"Error: {e}", f"Error: {e}"